results = [
    {
  "repo_name": "NNPDF/nnpdf",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "0.9000",
    "recall": "0.7500",
    "f1": "0.8182",
    "accuracy": "0.8125",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "FormingWorlds/PROTEUS",
  "llm": {
    "precision": "0.8571",
    "recall": "1.0000",
    "f1": "0.9231",
    "accuracy": "0.8750",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TP"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "0.7500",
    "recall": "0.5000",
    "f1": "0.6000",
    "accuracy": "0.5000",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "FN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "KernelTuner/kernel_tuner",
  "llm": {
    "precision": 0.9167,
    "recall": 0.9167,
    "f1": 0.9167,
    "accuracy": 0.9375,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "PE"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.7,
    "recall": 0.7,
    "f1": 0.7,
    "accuracy": 0.6875,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "dtscalibration/python-dts-calibration",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.8,
    "recall": 0.8,
    "f1": 0.8,
    "accuracy": 0.75,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "NLeSC/python-template",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      },
      {
        "softwareRequirements": "TN"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      }
    ]
  },
  "somef": {
    "precision": "0.7500",
    "recall": "0.7500",
    "f1": "0.7500",
    "accuracy": "0.7500",
    "elements": [
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "softwareRequirements": "TN"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "buildInstructions": "FN"
      }
    ]
  }
},
{
  "repo_name": "iomega/paired-data-form",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.625,
    "recall": 0.5,
    "f1": 0.5556,
    "accuracy": 0.5625,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "pism/pism",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.625,
    "recall": 0.5,
    "f1": 0.5556,
    "accuracy": 0.5625,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "NLeSC/MAGMa",
  "llm": {
    "precision": 1,
    "recall": 0.7143,
    "f1": 0.8333,
    "accuracy": 0.75,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TP"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.3333,
    "recall": 0.2,
    "f1": 0.25,
    "accuracy": 0.25,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "FN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "NLeSC/mcfly",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "0.6000",
    "recall": "0.7500",
    "f1": "0.6667",
    "accuracy": "0.6250",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "cdk/cdk",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TP"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.5,
    "recall": 0.4,
    "f1": 0.4444444444444445,
    "accuracy": 0.375,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "FN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "wadpac/GGIR",
  "llm": {
    "precision": 1,
    "recall": 0.8333333333333334,
    "f1": 0.9090909090909091,
    "accuracy": 0.875,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "FN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TP"
      },
      {
        "DOI": "TN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.75,
    "recall": 0.6,
    "f1": 0.6666666666666665,
    "accuracy": 0.625,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "FN"
      },
      {
        "DOI": "TN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "transientskp/tkp",
  "llm": {
    "precision": 1,
    "recall": 0.8333333333333334,
    "f1": 0.9090909090909091,
    "accuracy": 0.875,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "FN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.6666666666666666,
    "recall": 0.4,
    "f1": 0.5,
    "accuracy": 0.5,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "GrainLearning/grainLearning",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TP"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "0.8000",
    "recall": "0.6667",
    "f1": "0.7273",
    "accuracy": "0.6250",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "FN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "tpronk/splithalfr",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "0.7500",
    "recall": "0.3000",
    "f1": "0.4286",
    "accuracy": "0.5625",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TN"
      },
      {
        "Authors": "PE"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "FN"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "NLeSC/pattyvis",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.7,
    "recall": 0.7,
    "f1": 0.7,
    "accuracy": 0.6875,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "matchms/ms2deepscore",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 0.6,
    "recall": 0.6,
    "f1": 0.6,
    "accuracy": 0.625,
    "elements": [
      {
        "softwareRequirements": "PE"
      },
      {
        "buildInstructions": "PE"
      },
      {
        "Authors": "FP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "WDscholia/scholia",
  "llm": {
    "precision": 0.9167,
    "recall": 0.9167,
    "f1": 0.9167,
    "accuracy": 0.9375,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "PE"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 1,
    "recall": 0.6667,
    "f1": 0.8,
    "accuracy": 0.75,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "FN"
      },
      {
        "Keywords": "TP"
      }
    ]
  }
},
{
  "repo_name": "AI4S2S/lilio",
  "llm": {
    "precision": 1,
    "recall": 1,
    "f1": 1,
    "accuracy": 1,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "authors": "TP"
      },
      {
        "contributors": "TN"
      },
      {
        "funding": "TP"
      },
      {
        "doi": "TP"
      },
      {
        "license": "TP"
      },
      {
        "keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 1,
    "recall": 0.5714285714285714,
    "f1": 0.7272727272727273,
    "accuracy": 0.625,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "authors": "TP"
      },
      {
        "contributors": "TN"
      },
      {
        "funding": "FN"
      },
      {
        "doi": "TP"
      },
      {
        "license": "TP"
      },
      {
        "keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "eucp-project/storyboards",
  "llm": {
    "precision": "1.0000",
    "recall": "1.0000",
    "f1": "1.0000",
    "accuracy": "1.0000",
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": "1.0000",
    "recall": "0.5000",
    "f1": "0.6667",
    "accuracy": "0.6250",
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TP"
      },
      {
        "License": "TP"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
},
{
  "repo_name": "UtrechtUniversity/streetview-segmentation",
  "llm": {
    "precision": 1,
    "recall": 0.75,
    "f1": 0.8571428571428571,
    "accuracy": 0.875,
    "elements": [
      {
        "softwareRequirements": "TP"
      },
      {
        "buildInstructions": "TP"
      },
      {
        "Authors": "FN"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TN"
      },
      {
        "License": "TN"
      },
      {
        "Keywords": "TP"
      }
    ]
  },
  "somef": {
    "precision": 1,
    "recall": 0.25,
    "f1": 0.4,
    "accuracy": 0.625,
    "elements": [
      {
        "softwareRequirements": "FN"
      },
      {
        "buildInstructions": "FN"
      },
      {
        "Authors": "TP"
      },
      {
        "Contributors": "TN"
      },
      {
        "Funding": "TN"
      },
      {
        "DOI": "TN"
      },
      {
        "License": "TN"
      },
      {
        "Keywords": "FN"
      }
    ]
  }
}
]





import matplotlib.pyplot as plt
import numpy as np
import os

if not os.path.exists('repo_result'):
    os.makedirs('repo_result')
    print("Created 'repo_result' folder")

def plot_metrics_comparison(results, metric_name):
    """
    Create a horizontal bar plot comparing the specified metric between LLM and SOMEF
    using LaTeX-compatible colors with improvement labels aligned at the longest bar.
    
    Parameters:
    results (list): List of result dictionaries from repositories
    metric_name (str): The name of the metric to plot ('precision', 'recall', 'f1', 'accuracy')
    """
    # Extract data and convert to float
    names = [r['repo_name'] for r in results]
    llm_metrics = [float(r["llm"][metric_name]) for r in results]
    somef_metrics = [float(r["somef"][metric_name]) for r in results]
    
    # Calculate improvement percentage
    improvements = [(llm - somef) for llm, somef in zip(llm_metrics, somef_metrics)]
    
    # Find the maximum value across all bars to align the labels
    max_value = max(max(llm_metrics), max(somef_metrics))
    
    barHeight = 0.35
    r1 = np.arange(len(llm_metrics))
    r2 = [x + barHeight for x in r1]
    plt.figure(figsize=(10, max(8, len(names) * 0.4)), dpi=600) 
    
    gray_color = '#4C72B0' 
    blue_color = '#55A868'
    
    # Create horizontal bars
    llm_bars = plt.barh(r1, llm_metrics, height=barHeight, label='LLM', 
             color=gray_color, edgecolor='black', alpha=0.9)
    somef_bars = plt.barh(r2, somef_metrics, height=barHeight, label='SOMEF', 
             color=blue_color, edgecolor='black', alpha=0.9)
    
    plt.ylabel('Repositories', fontweight='bold')
    plt.xlabel(f'{metric_name.capitalize()}', fontweight='bold')
    plt.title(f'{metric_name.capitalize()} Comparison: LLM vs SOMEF')
    plt.yticks([r + barHeight/2 for r in range(len(llm_metrics))], names)
    plt.legend(loc='lower right')
    

    plt.xlim(0, max_value * 1.3)
    plt.grid(axis='x', linestyle='--', alpha=0.5)
    
    # Fixed position for improvement labels
    x_pos = max_value + 0.02
    
    # Add improvement percentages as text labels
    for i, (llm_val, somef_val, imp) in enumerate(zip(llm_metrics, somef_metrics, improvements)):
        # Calculate absolute improvement
        abs_improvement = llm_val - somef_val
        
        # Calculate relative improvement as percentage
        if somef_val > 0:
            rel_improvement = (abs_improvement / somef_val) * 100
            label = f"{rel_improvement:+.1f}%"
        else:
            label = f"{abs_improvement:.2f}"
            
        # Position the text at the fixed position
        y_pos = r1[i] + barHeight/2
        
        # Color based on whether LLM is better or worse
        text_color = 'green' if abs_improvement > 0 else 'red'
        
        # Add the text
        plt.text(x_pos, y_pos, label, va='center', fontsize=8, color=text_color, fontweight='bold')
    
    # Adjust layout and save with higher quality
    plt.tight_layout()
    plt.savefig(os.path.join('repo_result', f"{metric_name}_horizontal_barplot.pdf"), bbox_inches='tight', format='pdf')
    plt.close()

# Function to plot all metrics
def plot_all_metrics(results):
    """
    Generate separate plots for precision, recall, F1, and accuracy
    
    Parameters:
    results (list): List of result dictionaries from repositories
    """
    metrics = ['precision', 'recall', 'f1', 'accuracy']
    
    for metric in metrics:
        try:
            plot_metrics_comparison(results, metric)
            print(f"Created plot for {metric}")
        except KeyError:
            print(f"Warning: Could not find {metric} in results data")


#### OVERALL METRICS ####

def calculate_overall_metrics(results):
    """
    Calculate overall average metrics for LLM and SOMEF across all repositories.
    
    Parameters:
    results (list): List of result dictionaries from repositories
    
    Returns:
    dict: Dictionary containing average metrics for both LLM and SOMEF
    """
    metrics = ['precision', 'recall', 'f1', 'accuracy']
    overall = {'llm': {}, 'somef': {}}
    
    for metric in metrics:
        try:
            # Extract and convert to float
            llm_values = [float(r["llm"][metric]) for r in results]
            somef_values = [float(r["somef"][metric]) for r in results]
            
            # Calculate averages
            overall['llm'][metric] = sum(llm_values) / len(llm_values)
            overall['somef'][metric] = sum(somef_values) / len(somef_values)
            print("over_all_llm", overall['llm'][metric])
            print("over_all_somef", overall['somef'][metric])
            
            # Calculate improvements
            abs_improvement = overall['llm'][metric] - overall['somef'][metric]
            if overall['somef'][metric] > 0:
                rel_improvement = (abs_improvement / overall['somef'][metric]) * 100
                print("rel_improvement", rel_improvement)
            else:
                rel_improvement = float('inf') 
                
            overall['improvement_' + metric] = rel_improvement
            
        except KeyError:
            print(f"Warning: Could not find {metric} in all results data")
            overall['llm'][metric] = 0
            overall['somef'][metric] = 0
            overall['improvement_' + metric] = 0
            
    return overall

def plot_overall_metrics(results):
    """
    Create a bar plot comparing all metrics between LLM and SOMEF.
    
    Parameters:
    results (list): List of result dictionaries from repositories
    """
    # Calculate overall metrics
    overall = calculate_overall_metrics(results)
    
    # Metrics to plot
    metrics = ['precision', 'recall', 'f1', 'accuracy']
    
    # Extract values
    llm_values = [overall['llm'][m] for m in metrics]
    somef_values = [overall['somef'][m] for m in metrics]
    improvements = [overall['improvement_' + m] for m in metrics]
    

    barWidth = 0.35
    r1 = np.arange(len(metrics))
    r2 = [x + barWidth for x in r1]
    plt.figure(figsize=(12, 8), dpi=600)
    
    gray_color = '#4C72B0' 
    blue_color = '#55A868' 
    
    # Create vertical bars
    plt.bar(r1, llm_values, width=barWidth, label='LLM', 
            color=gray_color, edgecolor='black', alpha=0.9)
    plt.bar(r2, somef_values, width=barWidth, label='SOMEF', 
            color=blue_color, edgecolor='black', alpha=0.9)

    plt.xlabel('Metrics', fontweight='bold')
    plt.ylabel('Score', fontweight='bold')
    plt.title('Overall Metrics Comparison: LLM vs SOMEF', fontweight='bold')
    
    plt.xticks([r + barWidth/2 for r in range(len(metrics))], 
               [m.capitalize() for m in metrics], fontweight='bold')
    
    plt.legend(loc='upper right')
    plt.ylim(0, 1.2)
    plt.grid(axis='y', linestyle='--', alpha=0.5)
    
    # Add improvement percentages above the bars
    for i, (llm_val, somef_val, imp) in enumerate(zip(llm_values, somef_values, improvements)):
        y_pos = max(llm_val, somef_val) + 0.02
        x_pos = r1[i] + barWidth/2
        
        # Format the improvement text
        if not np.isinf(imp):
            label = f"{imp:+.1f}%"
        else:
            label = "N/A"
            
        # Text color based on improvement
        text_color = 'green' if imp > 0 else 'red'
        plt.text(x_pos, y_pos, label, ha='center', va='bottom', 
                 fontsize=10, color=text_color, fontweight='bold')
    
    # Add value labels on top of each bar
    for i, v in enumerate(llm_values):
        plt.text(r1[i], v + 0.01, f"{v:.2f}", ha='center', va='bottom', 
                 fontsize=8, color='black')
                 
    for i, v in enumerate(somef_values):
        plt.text(r2[i], v + 0.01, f"{v:.2f}", ha='center', va='bottom', 
                 fontsize=8, color='black')
    
    # Adjust layout and save
    plt.tight_layout()
    plt.savefig(os.path.join('repo_result', "overall_metrics_comparison.pdf"), bbox_inches='tight', format='pdf')
    plt.close()
    
    # Print the numerical results
    print("Overall Metrics Summary:")
    print("-----------------------")
    for metric in metrics:
        print(f"{metric.capitalize()}: LLM = {overall['llm'][metric]:.3f}, SOMEF = {overall['somef'][metric]:.3f}, " 
              f"Improvement = {overall['improvement_' + metric]:+.1f}%")
    
    return overall


plot_overall_metrics(results)
plot_all_metrics(results)

# Plot individual metrics:
plot_metrics_comparison(results, 'precision')
plot_metrics_comparison(results, 'recall')
plot_metrics_comparison(results, 'f1')
plot_metrics_comparison(results, 'accuracy')